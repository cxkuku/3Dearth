import { assign, serialize } from '@jmfe/jm-common';

function checkStatus(response) {
	if (response.status >= 200 && response.status < 300) {
		return response;
	} else {
		let error = new Error(response.statusText);
		error.response = response;
		throw error;
	}
}

function parseJSON(response) {
	return response.json();
}

let ajax = {};

ajax.get = function (url, params, opts) {
	url = url + '?' + serialize(params);
	let options = assign({
		method: 'GET',
		credentials: 'include'
	}, opts);
	return fetch(url, options).then(checkStatus).then(parseJSON);
};

ajax.post = function (url, params, opts) {
	let options = assign({
		method: 'POST',
		credentials: 'include',
		headers: {},
		body: JSON.stingify(params)
	}, opts);
	
	options.headers['Accept'] = 'application/json';
	options.headers['Content-Type'] = 'application/json';
	
	return fetch(url, options).then(checkStatus).then(parseJSON);
}

export default ajax;
