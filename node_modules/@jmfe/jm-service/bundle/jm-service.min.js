!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@jmfe/jm-common"),require("@jmfe/jm-cookie")):"function"==typeof define&&define.amd?define(["exports","@jmfe/jm-common","@jmfe/jm-cookie"],t):t((n.jm=n.jm||{},n.jm.service=n.jm.service||{}),n.jm.common,n.jm.cookie)}(this,function(n,t,e){"use strict";function r(n,e,r){function i(){s.parentNode&&s.parentNode.removeChild(s);try{delete window[a]}catch(n){window[a]=null}f&&clearTimeout(f)}r||(r={});var o=r.prefix||"jsonp",a=r.name||o+O++;a=r.cdnCallback?r.cdnCallback:a;var u=r.param||"callback",d=null!=r.timeout?r.timeout:6e4,c=document.getElementsByTagName("script")[0]||document.head,s=void 0,f=void 0;return n=n+"?"+t.serialize(e),new Promise(function(t,e){window[a]=function(n){i(),t(n)},d&&(f=setTimeout(function(){i(),e(new Error("Timeout"))},d)),n+=(~n.indexOf("?")?"&":"?")+u+"="+encodeURIComponent(a),n=n.replace("?&","?"),s=document.createElement("script"),s.src=n,s.onerror=function(){return e(new Error("Script loading error."))},c.parentNode.insertBefore(s,c)})}function i(n){if(n.status>=200&&n.status<300)return n;var t=new Error(n.statusText);throw t.response=n,t}function o(n){return n.json()}function a(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.isArray(n)&&(n=n.join(","));var i=A(n),o=L.filter(function(n){return n.key===i});if(o.length)return r(o[0].path,{},{cdnCallback:o[0].jsonpCallback});var a=e.isMain,u=t.assign({functionId:a?"queryMainBabelAdverts":"getBabelAdvertInfo",body:JSON.stringify({ids:n}),uuid:B},D);return r(J,u,e)}function u(n){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t.isArray(n)&&(n=n.join(","));var o=A(n),a=L.filter(function(n){return n.key===o});if(a.length)return r(a[0].path,{},{cdnCallback:a[0].jsonpCallback});var u=t.assign({functionId:i?"queryMainBabelProducts":"getBabelProductInfo",body:JSON.stringify({ids:n,todayFlag:e?"Y":"N"}),uuid:B},D);return r(J,u)}function d(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.isArray(n)&&(n=n.join(","));var i=A(n),o=L.filter(function(n){return n.key===i});if(o.length)return r(o[0].path,{},{cdnCallback:o[0].jsonpCallback});var a=e.isMain,u=t.assign({functionId:a?"queryMainBabelProducts":"getBabelProductInfo",body:JSON.stringify({ids:n,currentStageFlag:"Y"}),uuid:B},D);return r(J,u,e)}function c(n,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=A(n),a=L.filter(function(n){return n.key===o});if(a.length)return r(a[0].path,{},{cdnCallback:a[0].jsonpCallback});var u=t.assign({functionId:i?"queryMainBabelProducts":"getBabelProductInfo",body:JSON.stringify({groupId:n,stageId:e}),uuid:B},D);return r(J,u)}function s(n,e,i){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=A(n),u=L.filter(function(n){return n.key===a});if(u.length)return r(u[0].path,{},{cdnCallback:u[0].jsonpCallback});var d={groupId:n,num:e};i&&(d.position=i);var c=t.assign({functionId:o?"queryMainBabelProducts":"getBabelProductInfo",body:JSON.stringify(d),uuid:B},D);return r(J,c)}function f(n){var e=t.assign({functionId:"appointSMS",body:JSON.stringify({moduleId:n})},D);return r(J,e)}function g(n){var e=t.assign({functionId:"makeProductAppointment",body:JSON.stringify({skuId:n})},D);return r(J,e)}function l(n,e){t.isArray(e)&&(e=e.join(","));var i=t.assign({functionId:"queryProductAppointments",body:JSON.stringify({skuIds:e,activityId:n})},D);return r(J,i)}function y(n,e,i){var o=t.assign({functionId:"babelQueryActivity",body:JSON.stringify({activityId:n,pageId:e,moduleId:i})},D);return r(J,o)}function p(n){var e=t.assign({functionId:"batchQryModStock",body:JSON.stringify({moduleIds:n})},D);return r(J,e)}function v(n,e,i){var o=t.assign({functionId:"babelActivityLuckDraw",body:JSON.stringify({activityId:n,pageId:e,moduleId:i})},D);return r(J,o)}function m(n,e,i){var o=t.assign({functionId:"asyncLottery",body:JSON.stringify({activityId:n,pageId:e,moduleId:i})},D);return r(J,o)}function I(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={sid:t,num:1,wareId:n,actId:e};return P.get("//m.jd.com/cart/add.json",r,{credentials:"omit"})}function b(){var n=t.assign({functionId:"verifyAppNewUser",body:JSON.stringify({})},D);return r(J,n)}function h(n,e){var i=t.assign({functionId:"babelActivityGetShareInfo",body:JSON.stringify({activityId:n,pageId:e})},D);return r(J,i)}function j(n,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=t.assign({functionId:"jdDiscoveryInventoryListing",body:JSON.stringify({page:n,lastId:i,tag:o}),uuid:t.getUUID()||e.get("mba_muid")||""},D);return r(J,a)}function k(){var n=t.assign({functionId:"verifyPlusAndNewUser",body:JSON.stringify({})},D);return r(J,n)}function S(n){var e={rankId:"rank3001",provinceId:"1",time:"1DAY"},i=t.assign(e,n),o=t.assign({functionId:"rankList",body:JSON.stringify(i)},D);return r(J,o,{param:"jsonp"})}function N(n){var e={provinceId:"1",time:"1DAY"},i=t.assign(e,n),o=t.assign({functionId:"rankParty",body:JSON.stringify(i)},D);return r(J,o,{param:"jsonp"})}function w(n,e,i){var o=t.assign({functionId:"bICouponDraw",body:JSON.stringify({activityId:n,pageId:e,moduleId:i})},D);return r(J,o)}function C(n){Object.prototype.toString.call(n).toLowerCase().indexOf("array")>0?L=n:console.log("setCDNConf需要传入数组")}e="default"in e?e.default:e;var O=0,P={};P.get=function(n,e,r){n=n+"?"+t.serialize(e);var a=t.assign({method:"GET",credentials:"include"},r);return fetch(n,a).then(i).then(o)},P.post=function(n,e,r){var a=t.assign({method:"POST",credentials:"include",headers:{},body:JSON.stingify(e)},r);return a.headers.Accept="application/json",a.headers["Content-Type"]="application/json",fetch(n,a).then(i).then(o)};var A=function(n){return"jsonp"+n.split(",").join("i")},J="//api.m.jd.com/client.action",D={clientVersion:"1.0.0",client:"wh5"},B=t.getUUID()||e.get("mba_muid")||"",L=[];n.getAdvGroups=a,n.getProductGroups=u,n.getProductGroupsCurStage=d,n.getProductGroupStage=c,n.getProductGroupStages=s,n.makeAppointment=f,n.booking=g,n.getBookingInfo=l,n.getLuckyDrawInfo=y,n.batchLuckyDrawStock=p,n.doLuckyDraw=v,n.doLuckyDrawAsync=m,n.addToCart=I,n.verifyNewUser=b,n.getShareInfo=h,n.getDiscoveryInventoryList=j,n.verifyPlusAndNewUser=k,n.getRankCates=S,n.getRankParty=N,n.bICouponDraw=w,n.setCDNConf=C,n.jsonp=r,n.ajax=P,Object.defineProperty(n,"__esModule",{value:!0})});
