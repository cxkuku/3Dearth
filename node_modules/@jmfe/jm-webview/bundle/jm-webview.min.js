!function(e,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports,require("@jmfe/jm-common")):"function"==typeof define&&define.amd?define(["exports","@jmfe/jm-common"],i):i((e.jm=e.jm||{},e.jm.webview=e.jm.webview||{}),e.jm.common)}(this,function(e,i){"use strict";function n(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"openApp.jdMobile";window.location.href=o(e,i,n)}function o(e,i){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"openApp.jdMobile")+"://"+e+"?params="+encodeURIComponent(JSON.stringify(i))}function t(e,n){return o("virtual",i.assign({category:"jump",des:"productDetail",skuId:e},n))}function a(e,i){window.location.href=t(e,i)}function r(e,n){return o("virtual",i.assign({category:"jump",des:"jshopMain",shopId:e},n))}function c(e,i){window.location.href=r(e,i)}function l(){return i.isAndroid()?o("360buy",{type:1}):i.isIOS()?o("virtual",{category:"jump",des:"HomePage"}):void 0}function s(){window.location.href=l()}function d(e){return o("virtual",i.assign({category:"jump",des:"couponCenter"},e))}function p(e){window.location.href=d(e)}function w(e){return o("virtual",i.assign({category:"jump",des:"seckill"},e))}function u(e){window.location.href=w(e)}function h(e){console.warn("toFlashSale 已经改名为 toSecKill， 请使用新方法。"),u(e)}function f(e){return o("virtual",i.assign({category:"jump",des:"orderlist"},e))}function m(e){window.location.href=f(e)}function g(e){e=e||window.location.href;var n={v:1,returnurl:encodeURIComponent(e)};window.location.href="https://passport.m.jd.com/user/login.action?"+i.serialize(n)}function v(e){n("virtual",{category:"jump",action:"to",des:"m",url:e})}function b(e){return o("virtual",i.assign({category:"jump",des:"Discovery"},e))}function k(e){window.location.href=b(e)}function y(e,n){return o("virtual",i.assign({category:"jump",des:"faxian_article",id:e},n))}function S(e,i){window.location.href=y(e,i)}function A(e,n){return o("virtual",i.assign({category:"jump",des:"faxian_author",authorId:e},n))}function N(e,i){window.location.href=A(e,i)}function j(e){return o("virtual",i.assign({category:"jump",des:"inventory"},e))}function C(e){window.location.href=j(e)}function I(e,n){return o("virtual",i.assign({category:"jump",des:"inventoryDetail",id:e},n))}function M(e,i){window.location.href=I(e,i)}function B(e){return o("virtual",i.assign({category:"jump",des:"cartB"},e))}function O(e){window.location.href=B(e)}function H(){var e=i.getAppVersion("jd");i.versionCompare(e,"5.0.0")<0||(i.isAndroid()?window.AndroidNavi&&window.AndroidNavi.refreshCart():i.isIOS()&&n("communication",{action:"sh_refreshCart"}))}function _(){var e=i.getAppVersion("jd");i.versionCompare(e,"5.0.0")<0||(i.isAndroid()?window.AndroidNavi&&window.AndroidNavi.setCart(JSON.stringify({isShow:"Y"})):i.isIOS()&&(i.versionCompare(e,"5.1.0")<0?n("communication",{action:"sh_showCart"}):window.MobileNavi&&window.MobileNavi.configBtn(JSON.stringify({type:"cart",display:"show",position:"outside",icon:"",title:"购物车",jump:""}))))}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"find";return o("virtual",{category:"jump",des:{find:"FindLivePlayList",seckill:"SecKillLivePlayList"}[e],position:Ne[e]})}function J(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"find";window.location.href=U(e)}function W(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"find";return o("virtual",{category:"jump",des:{find:"FindLivePreDetail",seckill:"SecKillLivePreDetail"}[i],id:e,position:Ne[i]})}function T(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"find";window.location.href=W(e,i)}function P(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"find";return o("virtual",{category:"jump",des:"LivePlayerRoom",id:e,position:Ne[i]})}function L(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"find";window.location.href=P(e,i)}function D(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function R(e,i){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?e:i}function E(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(e,i):e.__proto__=i)}function V(){return i.isMobile()?"openapp.jdmobile":i.isTablet()&&i.isIOS()?"openapp.jdipad":void 0}function q(e){n("communication",{des:"share",type:111,title:e.title,content:e.content,shareUrl:e.url,iconUrl:e.img,shareActionType:e.shareActionType,channel:e.channel,qrparam:e.qrparam,callback:e.callbackSwitcher,clickcallback:e.clickcallbackSwitcher})}function x(e){shareHelper.initShare(JSON.stringify({title:e.title,content:e.content,shareUrl:decodeURIComponent(e.url),iconUrl:decodeURIComponent(e.img),shareActionType:e.shareActionType,channel:e.channel,qrparam:e.qrparam,callback:e.callbackSwitcher,clickcallback:e.clickcallbackSwitcher,eventId:""}))}function F(e,i){shareHelper[e](i.title,i.content,decodeURIComponent(i.url),decodeURIComponent(i.img),i.callbackSwitcher)}function K(e,i){shareHelper[e](i.title,i.content,decodeURIComponent(i.url),decodeURIComponent(i.img))}function Q(e,i){n("communication",{action:i,title:e.title,content:e.content,shareUrl:e.url,iconUrl:e.img,isCallBack:e.callbackSwitcher})}function X(e){n("virtual",{category:"jump",des:"share",type:"111",title:e.title,content:e.content,shareUrl:e.url,imageUrl:e.img,iconUrl:e.img,qrparam:e.qrparam,channel:e.channel,isCallBack:e.callbackSwitcher,clickcallback:e.clickcallbackSwitcher,shareActionType:e.shareActionType},V())}function z(e,i){return""==i?e:(e+"&"+i).replace(/[&?]{1,2}/,"?")}function Y(e){window.jdappShareRes=function(i){i.hasOwnProperty("shareResult")?e.callback&&e.callback(i):e.clickcallback&&e.clickcallback(i)}}function Z(e){var n={Wxfriends:"WeChat_Friend",Wxmoments:"WeChat_FriendTimeline",Sinaweibo:"Weibo",QQfriends:"QQFriend_SHARE_CLIENT",QQzone:"QQZone_SHARE_CLIENT",Moreshare:""},o="";if(e){if(i.isIOS()){var t=i.getAppVersion("jd");if(i.isMobile()&&i.isApp("jd")&&i.versionCompare(t,"4.4.0")>=0&&i.versionCompare(t,"5.0.0")<0){if(o=n[e])return o;throw new Ie("输入的channel参数在iphone版本中不存在")}return e}return e}return e}function G(e){return["title","content","url","img"].every(function(i){return void 0!==e[i]})}function $(e){if(G(e)){var n={channel:"",qrparam:null,callback:null,clickcallback:null},o=void 0,t=void 0,a=void 0,r=void 0;try{"[object Object]"===Object.prototype.toString.call(e)&&i.assign(n,e),o="function"==typeof n.callback,a="function"==typeof n.clickcallback,t=o?Ce.WITH_CALLBACK:Ce.WITHOUT_CALLBACK,r=a?Ce.WITH_CALLBACK:Ce.WITHOUT_CALLBACK,o&&a?Y({callback:n.callback,clickcallback:n.clickcallback}):o?Y({callback:n.callback}):a&&Y({clickcallback:n.clickcallback}),"[object Object]"===Object.prototype.toString.call(n.qrparam)&&(n.qrparam.top_pic=n.qrparam.top_pic?encodeURIComponent(decodeURIComponent(n.qrparam.top_pic)):"",n.qrparam.mid_pic=n.qrparam.mid_pic?encodeURIComponent(decodeURIComponent(n.qrparam.mid_pic)):""),n.callbackSwitcher=t,n.clickcallbackSwitcher=r,n.url=z(n.url,"_ts="+(new Date).getTime()),n.channel=Z(n.channel),n.url=encodeURIComponent(n.url),n.img=encodeURIComponent(n.img)}catch(e){throw e}return n}throw new Ie("调用方法时传入配置对象格式错误，请查看文档")}function ee(e){if(i.isApp("jd"))try{var n=null;if(n=$(e),n.shareActionType=Ce.SHARE_ACTION_SET,i.isAndroid())if(window.shareHelper)if("function"==typeof shareHelper.initShare)x(n);else if("function"==typeof shareHelper.setShareInfoCallback)if(n.callbackSwitcher===Ce.WITH_CALLBACK)try{F("setShareInfoCallback",n)}catch(e){K("setShareInfoCallback",n)}else try{F("setShareInfoCallback",n)}catch(e){"function"==typeof shareHelper.setShareInfo&&K("setShareInfo",n)}else"function"==typeof shareHelper.setShareInfo&&K("setShareInfo",n);else q(n);else if(i.isIOS()){var o=i.getAppVersion("jd");i.isIPhone()&&i.versionCompare(o,"5.0.0")>=0||i.isIpad()&&i.versionCompare(o,"3.6.0")>=0?X(n):i.isIPhone()&&Q(n,"syncShareData")}}catch(e){throw e}}function ie(e){try{var n=null;if(n=$(e),n.shareActionType=Ce.SHARE_ACTION_PANE,i.isAndroid())i.isApp("jd")&&window.shareHelper?"function"==typeof shareHelper.initShare?x(n):"function"==typeof shareHelper.callShare?F("callShare",n):q(n):q(n);else if(i.isIOS()){var o=i.getAppVersion("jd");i.isIPhone()&&i.versionCompare(o,"5.0.0")>=0||i.isIpad()&&i.versionCompare(o,"3.6.0")>=0?X(n):i.isIPhone()&&Q(n,"share")}}catch(e){throw e}}function ne(e){try{var o=null;if(o=$(e),o.shareActionType=Ce.SHARE_ACTION_OPEN,i.isAndroid())i.isApp("jd")&&window.shareHelper?"function"==typeof shareHelper.initShare?x(o):"function"==typeof shareHelper.sendShare?shareHelper.sendShare(o.title,o.content,decodeURIComponent(o.url),decodeURIComponent(o.img),o.channel,o.callbackSwitcher):q(o):q(o);else if(i.isIOS()){if(!o.channel)throw new Ie("分享渠道未设置");var t=i.getAppVersion("jd");i.isIPhone()&&i.versionCompare(t,"5.0.0")>=0||i.isIpad()&&i.versionCompare(t,"3.6.0")>=0?X(o):i.isIPhone()&&n("virtual",{category:"jump",des:"share",type:111,title:o.title,content:o.content,shareUrl:o.url,imageUrl:o.img,channel:o.channel,isCallBack:o.callbackSwitcher})}}catch(e){throw e}}function oe(e){var n=i.getAppVersion("jd");!i.isApp("jd")||i.versionCompare(n,"6.0.0")<0||(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"setNaviBackground",params:JSON.stringify(e),callBackName:null,callBackId:null}):window.MobileNavi&&MobileNavi.setNaviBackground(JSON.stringify(e)))}function te(){var e=i.getAppVersion("jd"),n={type:"clear_js",display:"",position:"",icon:"",title:"",jump:""};console.log({method:"configBtnSince610",params:JSON.stringify({clear_js:n}),callBackName:null,callBackId:null}),i.isApp("jd")&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"configBtnSince610",params:JSON.stringify({clear_js:n}),callBackName:null,callBackId:null}):i.versionCompare(e,"6.1.0")<0?window.MobileNavi&&MobileNavi.configBtn(JSON.stringify(n)):window.MobileNavi&&MobileNavi.configBtnSince610(JSON.stringify({clear_js:n})))}function ae(e){var n={type:"",display:"",position:"",icon:"",title:"",jump:""},o=["homepage","search","calendar","cart","message","custom"];if(i.isObject(e)&&i.isApp("jd"))for(var t=i.assign(n,e),a=0;a<o.length;a++)t.type===o[a]&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"configBtn",params:JSON.stringify(t),callBackName:null,callBackId:null}):window.MobileNavi&&MobileNavi.configBtn(JSON.stringify(t)))}function re(e){var n="",o=["homepage","search","calendar","cart","message","custom"],t={};if(i.isObject(e)&&i.isApp("jd")){for(var a in e)if(n=!0,i.isObject(e[a])){for(var r=0;r<o.length;r++)if(e[a].type===o[r]){n=!1;break}n||(t[a]=e[a],t[a].display=e[a].display||"",t[a].icon=e[a].icon||"",t[a].jump=e[a].jump||"",t[a].position=e[a].position||"",t[a].title=e[a].title||"")}else{if(!i.isArray(e[a]))throw new Error("调用方法时传入配置对象格式错误");if(t[a]=e[a],t[a].length<3){n=!1;break}}n||(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"configBtnSince610",params:JSON.stringify(t),callBackName:null,callBackId:null}):window.MobileNavi&&window.MobileNavi.configBtnSince610(JSON.stringify(t)))}}function ce(){i.isApp("jd")&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"showCloseBtn"}):window.MobileNavi&&MobileNavi.showCloseBtn())}function le(e){var n={blackImg:"",whiteImg:""};i.isApp("jd")&&i.isObject(e)&&(i.assign(n,e),i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"enableTransparent",params:JSON.stringify(n),callBackName:null,callBackId:null}):window.MobileNavi&&MobileNavi.enableTransparent(JSON.stringify(n)))}function se(e){i.isApp("jd")&&i.isString(e)&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"setTitle",params:e,callBackName:null,callBackId:null}):window.MobileNavi&&MobileNavi.setTitle(e))}function de(e){i.isApp("jd")&&i.isString(e)&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"showNativeBarcodeScan",params:e,callBackName:null,callBackId:null}):window.MobileNavi&&MobileNavi.showNativeBarcodeScan(e))}function pe(){i.isApp("jd")&&(i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"showNativeUpload"}):window.MobileNavi&&MobileNavi.showNativeUpload())}function we(){i.isWebview("xview")&&(i.isWebview("wk")?window.webkit.messageHandlers.XView.postMessage({method:"close"}):window.XView&&window.XView.close())}function ue(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i.isWebview("xview")&&(i.isWebview("wk")?window.webkit.messageHandlers.XView.postMessage({method:"configCloseButton",params:{closeIcon:o,x:e,y:n},callBackName:null,callBackId:null}):window.XView&&XView.configCloseButton(o,e,n))}function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";i.isApp("jd")&&(i.isWebview("wk")?window.webkit.messageHandlers.JDPaySdk.postMessage({method:"jdpaysdk_pay",params:{pin:e,code:n,mode:o},callBackName:null,callBackId:null}):window.JDPaySdk&&JDPaySdk.jdpaysdk_pay(e,n,o))}function fe(){i.isApp("jd")&&(i.isWebview("wk")?window.webkit.messageHandlers.JDPaySdk.postMessage({method:"jdpaysdk_pop"}):window.JDPaySdk&&JDPaySdk.jdpaysdk_pop())}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(i.isApp("jd")){var t={imgUrl:e,callBackName:n,callBackId:o};try{i.isWebview("wk")?window.webkit.messageHandlers.JDAppUnite.postMessage({method:"saveImageToPhoteAlbum",params:JSON.stringify(t),callBackName:null,callBackId:null}):window.JDAppUnite&&JDAppUnite.saveImageToPhoteAlbum(JSON.stringify(t))}catch(e){throw new Error(e)}}}function ge(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(i.isApp("jd")){var o={channelName:e,callBackName:n};try{i.isWebview("wk")?window.webkit.messageHandlers.MobileLogin.postMessage({method:"bindSocialAccountWithJsonString",params:JSON.stringify(o),callBackName:null,callBackId:null}):window.MobileLogin&&MobileLogin.bindSocialAccountWithJsonString(JSON.stringify(o))}catch(e){throw new Error(e)}}}function ve(){i.isApp("jd")&&(i.isIOS()?window.location.href="objc:callCamera":i.isAndroid()&&window.JDClient&&window.JDClient.openCamera())}function be(){if(i.isApp("jd"))try{i.isWebview("wk")?window.webkit.messageHandlers.JDAppUnite.postMessage({method:"closeLiveSWindow"}):window.JDAppUnite&&JDAppUnite.closeLiveSWindow()}catch(e){throw new Error(e)}}function ke(e){if(i.isApp("jd"))try{i.isWebview("wk")?window.webkit.messageHandlers.JDAppUnite.postMessage({method:"signWeixinPay",params:e}):window.JDAppUnite&&JDAppUnite.signWeixinPay(e)}catch(e){throw new Error(e)}}function ye(e){if(i.isApp("jd")){if("string"!=typeof e)throw new Error("cbkFunc need string");try{i.isWebview("wk")?window.webkit.messageHandlers.JDAppUnite.postMessage({method:"getFingerInfo",params:e}):window.JDAppUnite&&JDAppUnite.getFingerInfo(e)}catch(e){throw new Error(e)}}}function Se(e){if(i.isApp("jd")){if("string"!=typeof e)throw new Error("cbkFunc need string");try{i.isWebview("wk")?window.webkit.messageHandlers.MobileNavi.postMessage({method:"getNaviHeight",params:e}):window.MobileNavi&&MobileNavi.getNaviHeight(e)}catch(e){throw new Error(e)}}}function Ae(){if(i.isApp("jd"))try{i.isWebview("wk")?window.webkit.messageHandlers.JDAppUnite.postMessage({method:"sourceIsReady",params:"1"}):window.JDAppUnite&&window.JDAppUnite.sourceIsReady("1")}catch(e){throw new Error(e)}}var Ne={find:"0",seckill:"2"},je=function(){function e(e,i){for(var n=0;n<i.length;n++){var o=i[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(i,n,o){return n&&e(i.prototype,n),o&&e(i,o),i}}(),Ce={WITH_CALLBACK:"Y",WITHOUT_CALLBACK:"N",SHARE_ACTION_SET:"S",SHARE_ACTION_PANE:"P",SHARE_ACTION_OPEN:"O"},Ie=function(e){function i(e){D(this,i);var n=R(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n.message=e,n.name="JdShareException",n}return E(i,e),je(i,[{key:"toString",value:function(){return this.name+": "+this.message}}]),i}(Error);e.nativeCall=n,e.buildSchema=o,e.getProductSchema=t,e.toProduct=a,e.getShopSchema=r,e.toShop=c,e.getHomeSchema=l,e.toHome=s,e.getCouponCenterSchema=d,e.toCouponCenter=p,e.getSecKillSchema=w,e.toSecKill=u,e.toFlashSale=h,e.getOrderListSchema=f,e.toOrderList=m,e.toLogin=g,e.openNewWebView=v,e.getDiscoverySchema=b,e.toDiscovery=k,e.getArticleSchema=y,e.toArticle=S,e.getAuthorSchema=A,e.toAuthor=N,e.getInventorySchema=j,e.toInventory=C,e.getInventoryDetailSchema=I,e.toInventoryDetail=M,e.getCartSchema=B,e.toCart=O,e.refreshCart=H,e.showCartButton=_,e.getLiveCastListSchema=U,e.toLiveCastList=J,e.getLiveCastPreviewSchema=W,e.toLiveCastPreview=T,e.getLiveCastRoomSchema=P,e.toLiveCastRoom=L,e.setShareInfo=ee,e.callSharePane=ie,e.sendDirectShare=ne,e.setNaviBackground=oe,e.configBtnClear=te,e.configBtnSet=ae,e.configBtnSince610=re,e.showCloseBtn=ce,e.enableTransparent=le,e.setTitle=se,e.showNativeBarcodeScan=de,e.showNativeUpload=pe,e.XViewClose=we,e.XViewConfigCloseButton=ue,e.JDPaySdk_pay=he,e.JDPaySdk_pop=fe,e.saveImageToPhoteAlbum=me,e.bindSocialAccountWithJsonString=ge,e.selectImage=ve,e.closeLivesWindow=be,e.goWxUrl=ke,e.getFingerInfo=ye,e.getNavHeight=Se,e.sourceIsReady=Ae,Object.defineProperty(e,"__esModule",{value:!0})});
