import * as basic from '../src/basic';
require('chai').should();

const ua = {
	iphone: 'jdapp;iPhone;5.2.0;8.4;037edd72999a53dba697a6379b715f015e1beaf2;network/wifi;supportApplePay/0;pv/82.9;pap/JA2015_311210|(null)|IOS 8.4;psn/23;psq/2;ref/JDNewBarCodeScanViewController;usc/;umd/;ucp/;utr/;Mozilla/5.0 (iPhone; CPU iPhone OS 8_4 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12H143',
	android: 'jdapp;android;5.2.0;6.0;869949021137516-020000000000;network/wifi;osp/android;apv/5.2.0;osv/6.0;uid/869949021137516-020000000000;pv/1.7;psn/869949021137516-020000000000|1;psq/7;ref/;pap/JA2015_311210|5.2.0|ANDROID 6.0;usc/;ucp/;umd/;utr/;adk/;ads/;Mozilla/5.0 (Linux; Android 6.0; FRD-AL10 Build/HUAWEIFRD-AL10) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036558 Safari/537.36'
};

describe('Basic', () => {
	beforeEach(() => {
		global.window = { location: {} };
		global.navigator = { userAgent: ''};
	});

	describe('toProduct()', () => {
		it('should build product url', () => {
			basic.toProduct(123);
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22productDetail%22%2C%22skuId%22%3A123%7D');
		});
	});

	describe('toShop()', () => {
		it('should build shop url', () => {
			basic.toShop(123);
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22jshopMain%22%2C%22shopId%22%3A123%7D');
		});
	});

	describe('toHome()', () => {
		it('should build homepage url for android', () => {
			navigator.userAgent = ua.android;
			basic.toHome();
			window.location.href.should.equal('openApp.jdMobile://360buy?params=%7B%22type%22%3A1%7D');
		});

		it('should build homepage url for iphone', () => {
			navigator.userAgent = ua.iphone;
			basic.toHome();
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22HomePage%22%7D');
		});
	});

	describe('toCouponCenter()', () => {
		it('should build coupon center url', () => {
			basic.toCouponCenter();
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22couponCenter%22%7D');
		});
	});

	describe('toLogin()', () => {
		it('should build login page url', () => {
			basic.toLogin('http://m.jd.com');
			window.location.href.should.equal('https://passport.m.jd.com/user/login.action?v=1&returnurl=http%3A%2F%2Fm.jd.com');
		});
	});

	describe('toSecKill()', () => {
		it('should build sec kill channel url', () => {
			basic.toSecKill();
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22seckill%22%7D');
		});
	});

	describe('openNewWebView()', () => {
		it('open url in new webview window', () => {
			basic.openNewWebView('http://m.jd.com');
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22action%22%3A%22to%22%2C%22des%22%3A%22m%22%2C%22url%22%3A%22http%3A%2F%2Fm.jd.com%22%7D');
		});
	});
});
