import * as cart from '../src/cart';
import sinon from 'sinon';
require('chai').should();

const ua = {
	iphone: 'jdapp;iPhone;5.2.0;8.4;037edd72999a53dba697a6379b715f015e1beaf2;network/wifi;supportApplePay/0;pv/82.9;pap/JA2015_311210|(null)|IOS 8.4;psn/23;psq/2;ref/JDNewBarCodeScanViewController;usc/;umd/;ucp/;utr/;Mozilla/5.0 (iPhone; CPU iPhone OS 8_4 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12H143',
	iphone500: 'jdapp;iPhone;5.0.0;8.4;037edd72999a53dba697a6379b715f015e1beaf2;network/wifi;supportApplePay/0;pv/82.9;pap/JA2015_311210|(null)|IOS 8.4;psn/23;psq/2;ref/JDNewBarCodeScanViewController;usc/;umd/;ucp/;utr/;Mozilla/5.0 (iPhone; CPU iPhone OS 8_4 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12H143',
	android: 'jdapp;android;5.2.0;6.0;869949021137516-020000000000;network/wifi;osp/android;apv/5.2.0;osv/6.0;uid/869949021137516-020000000000;pv/1.7;psn/869949021137516-020000000000|1;psq/7;ref/;pap/JA2015_311210|5.2.0|ANDROID 6.0;usc/;ucp/;umd/;utr/;adk/;ads/;Mozilla/5.0 (Linux; Android 6.0; FRD-AL10 Build/HUAWEIFRD-AL10) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036558 Safari/537.36'
};

describe('Cart', () => {
	beforeEach(() => {
		global.window = { location: {} };
		global.navigator = { userAgent: ''};
	});

	describe('toCart()', () => {
		it('should build cart url', () => {
			cart.toCart(123);
			window.location.href.should.equal('openApp.jdMobile://virtual?params=%7B%22category%22%3A%22jump%22%2C%22des%22%3A%22cartB%22%7D');
		});
	});

	describe('refreshCart()', () => {
		it('should refresh the cart in android', () => {
			navigator.userAgent = ua.android;
			window.AndroidNavi = {
				refreshCart: sinon.spy()
			};
			cart.refreshCart();
			window.AndroidNavi.refreshCart.called.should.be.true;
		});

		it('should refresh the cart in iphone', () => {
			navigator.userAgent = ua.iphone;
			cart.refreshCart();
			window.location.href.should.equal('openApp.jdMobile://communication?params=%7B%22action%22%3A%22sh_refreshCart%22%7D');
		});
	});

	describe('showCartButton()', () => {
		it('should show cart button in android', () => {
			navigator.userAgent = ua.android;
			window.AndroidNavi = {
				setCart: sinon.spy()
			};
			cart.showCartButton();
			window.AndroidNavi.setCart.called.should.be.true;
		});

		it('should show cart button in iphone for version >=5.1.0', () => {
			navigator.userAgent = ua.iphone;
			window.MobileNavi = {
				configBtn: sinon.spy()
			};
			cart.showCartButton();
			window.MobileNavi.configBtn.called.should.be.true;
		});

		it('should show cart button in iphone for version <5.1.0, >= 5.0.0', () => {
			navigator.userAgent = ua.iphone500;
			cart.showCartButton();
			window.location.href.should.equal('openApp.jdMobile://communication?params=%7B%22action%22%3A%22sh_showCart%22%7D');
		});
	});
});
