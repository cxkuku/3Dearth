const ua = {
	iphone: 'jdapp;iPhone;5.2.0;8.4;037edd72999a53dba697a6379b715f015e1beaf2;network/wifi;supportApplePay/0;pv/82.9;pap/JA2015_311210|(null)|IOS 8.4;psn/23;psq/2;ref/JDNewBarCodeScanViewController;usc/;umd/;ucp/;utr/;Mozilla/5.0 (iPhone; CPU iPhone OS 8_4 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12H143',
	android: 'jdapp;android;5.2.0;6.0;869949021137516-020000000000;network/wifi;osp/android;apv/5.2.0;osv/6.0;uid/869949021137516-020000000000;pv/1.7;psn/869949021137516-020000000000|1;psq/7;ref/;pap/JA2015_311210|5.2.0|ANDROID 6.0;usc/;ucp/;umd/;utr/;adk/;ads/;Mozilla/5.0 (Linux; Android 6.0; FRD-AL10 Build/HUAWEIFRD-AL10) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/37.0.0.0 Mobile MQQBrowser/6.2 TBS/036558 Safari/537.36'
};

global.navigator = { userAgent: ua.iphone };

import * as share from '../src/share_orig';
import sinon from 'sinon';
require('chai').should();

let shareInfo = {
	title: 'jd', 
	content: 'ebusiness', 
	url: 'http://m.jd.com', 
	img: 'http://m.jd.com/icon.png'
};

describe('Webview', () => {
	beforeEach(() => {
		global.window = { location: {} };
		global.navigator = { userAgent: ''};
	});

	describe('callSharePane()', () => {
		it-('should build share menu call url for android', () => {
			navigator.userAgent = ua.android;
			share.callSharePane(shareInfo);
			window.location.href.should.equal('openapp.jdmobile://communication?params={"des":"share","type":"111","title":"jd","content":"ebusiness","shareUrl":"http%3A%2F%2Fm.jd.com%3F_ts%3D1474441689965","iconUrl":"http%3A%2F%2Fm.jd.com%2Ficon.png","shareActionType":"P","channel":"","qrparam":"null","callback":"N","clickcallback":"N"}');
		});

		it-('should build share menu call url for iphone', () => {
			navigator.userAgent = ua.iphone;
			share.callSharePane(shareInfo);
			window.location.href.should.equal('openapp.jdmobile://virtual?params={"category":"jump","des":"share","type":"111","title":"jd","content":"ebusiness","shareUrl":"http%3A%2F%2Fm.jd.com","imageUrl":"http%3A%2F%2Fm.jd.com%2Ficon.png","iconUrl":"http%3A%2F%2Fm.jd.com%2Ficon.png","qrparam":null,"channel":"","isCallBack":"N","clickcallback":"N","shareActionType":"P"}');
		});
	});

	describe('setShareInfo()', () => {
		it-('should call setShareInfo for android', () => {
			navigator.userAgent = ua.android;
			global.shareHelper = {
				setShareInfo: sinon.spy()
			};
			share.setShareInfo(shareInfo);
			shareHelper.setShareInfo.calledWith('jd', 'ebusiness', 'http://m.jd.com', 'http://m.jd.com/icon.png');
		});

		it-('should build set share info url for iphone', () => {
			navigator.userAgent = ua.iphone;
			share.setShareInfo(shareInfo);
			window.location.href.should.equal('openApp.jdMobile://communication?params={"action":"syncShareData","title":"jd","content":"ebusiness","shareUrl":"http://m.jd.com","iconUrl":"http://m.jd.com/icon.png"}');
		});
	});
});
