<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>xview测试</title>
	<meta charset="UTF-8">
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
	<link href="./bootstrap.min.css" type="text/css" rel="stylesheet">

	<style type="text/css">
		html{
			height: 100%;

		}
		body {
			background: white;
			padding-bottom: 50px;
			height: 100%;
			overflow: auto;
			-webkit-overflow-scrolling : touch;
		}

		section {
		}

		input,
		textarea {
			border: 1px solid #ccc;
			font-size: 18px;
			padding: 5px 10px;
			width: 130px;
		}

		.action-btn {
			font-size: 18px;
			border: 1px solid #888;
			padding: 5px 10px;
			margin: 10px 5px;
			border-radius: 10px;
			background: linear-gradient(to bottom, #ddd 0%, #bbb 100%);
		}

		h1 {
			text-align: center;
			border-bottom: 1px solid #ccc;
			padding: 15px 0;
			margin-bottom: 15px;
		}

		h2 {
			margin-top: 15px;
			font-size: 24px;
		}

		dl {
			margin-bottom: 0;
		}
		dt,
		dd {
			display: inline-block;
			width: 45%;
			margin: 0 0 10px;
			padding: 0;
		}

		dt {
			text-align: right;
		}

		.setction {
			margin-top: 15px;
		}

		.pic {
			height: auto;
		}

		.text {
			width: 100%;
		}

		#submit {
			width: 100%;
		}

		h4 {
			margin-top: 50px;
		}

		select {
			height: 45px;
		}

		option {
			height: 45px;
		}

		.btn {
			margin-bottom: 10px;
		}

		label.checkbox {
			padding: 10px 0;
		}

		.row {
			border-bottom-style: dotted;
			border-bottom-width: 1px;
			border-bottom-color: #0f0f0f;
			margin: 10px auto;
		}

		.btn-style {
			width: 100%;
		}
		input {
			width: 100%;
		}

		.setction {
			margin-top: 15px;
		}

		.btn-style {
			width: 100%;
		}

		.jump-to-btn h4 {
			margin-top: 15px;
		}
		.conatinerwrapper{
			padding:10px;
		}
		.form-group{
			margin-bottom: 10px;
		}
	</style>
</head>

<body>
<section>
	<h2>环境信息</h2>
	<dl>
		<dt>京东 app 版本：</dt>
		<dd id="appver">unknown</dd>
		<dt>操作系统：</dt>
		<dd id="os">unknown</dd>
		<dt>网络状态：</dt>
		<dd id="network">unknown</dd>
	</dl>
</section>

<div class='container'>
	<h2 style='padding:0 15px;'>IOSxView关闭协议</h2>
	<div class='setction col-xs-12 col-sm-12' style='margin-top:0;'>
		<button class='col-xs-12 col-sm-12 btn-info btn' id='ios-close-btn1'>sh_xview_close</button>
		<button class='col-xs-12 col-sm-12 btn-info btn' style='margin-top:10px;' id='ios-close-btn2'>6.1 XView.close</button>
	</div>
</div>

<div class='container'>
	<h2 style='padding:0 15px;'>6.1 定制Xview关闭按钮 XViewConfigCloseButton</h2>
	<div class='btn-group setction col-xs-12 col-sm-12'>
		<button class='btn-info btn btn-style' id='center-close-btn'>确认设置↓</button>
	</div>
	<div class='setction col-xs-12 col-sm-12' style='margin-top:0;'>
		<div>closePositionX</div>
		<div class='text '><input type="text" class='text' value='0.6' id='closePositionX'></div>
	</div>
	<div class='setction col-xs-12 col-sm-12'>
		<div>closePositionY</div>
		<div class='text '><input type="text" class='text' value='0.6' id='closePositionY'></div>
	</div>
	<div class='setction col-xs-12 col-sm-12'>
		<div>closeIcon</div>
		<textarea id="closeIcon" rows="5" style='width:100%;'>https://st.360buyimg.com/common/commonH_B/images/2015/top-jdlogo.png</textarea>
	</div>

</div>

<div class='container' style='margin-top:50px;'>
	<h2 style='padding:0 15px;'>6.1 H5图片下载及指定目录保存 saveImageToPhoteAlbum</h2>
	<div class='setction col-xs-12 col-sm-12' style='margin-top:0;'>
		<h5>点击选择图片</h5>
		<div id='pic-choose' class='clearfix'>
			<div class='col-xs-12 col-xs-12' style='margin-top:10px;border:1px solid #333;padding:5px;'><img src="./pic3.jpg" alt="" style='width:100%;' data-id='1'></div>
			<div class='col-xs-12 col-xs-12' style='margin-top:10px;border:1px solid #333;padding:5px;'><img src="./pic1.jpg" alt="" style='width:100%;' data-id='2'></div>
			<div class='col-xs-12 col-xs-12' style='margin-top:10px;border:1px solid #333;padding:5px;'><img src="./pic2.jpg" alt="" style='width:100%;' data-id='3'></div>
		</div>
		<div class='col-xs-12 col-sm-12' style='margin-top:10px;'>选中的图片地址</div>
		<textarea id="picUrl" rows="5" style='width:100%;'></textarea>
		<div>callBackId</div>
		<div class='text '><input type="text" class='text' value='pic1' id='callBackId'></div>
	</div>
	<div class='btn-group setction col-xs-12 col-sm-12'>
		<button class='btn-info btn btn-style' id='center-pic-btn'>确认下载</button>
	</div>
</div>

<div class='container'>
	<h2 style='padding:0 15px;'>微信QQ授权登录</h2>
	<div class="block clearfix">
		<div class='col-xs-12 col-sm-12'>1.channelName:(QQ or WX)</div>
		<div class='col-xs-12 col-sm-12'>
			<textarea class='text' rows="2" id="set-login-channelName">QQ</textarea>
		</div>
	</div>
	<button class='col-xs-12 col-sm-12 btn-info btn' id='set-login-btn'>确认</button>
</div>

<div class='container'>
	<h2 style='padding:0 15px;'>京东支付</h2>
	<div class="block clearfix">
		<div class='col-xs-12 col-sm-12'>1.pin</div>
		<div class='col-xs-12 col-sm-12'>
			<textarea class='text' rows="2" id="set-pay-pin">846697463</textarea>
		</div>
	</div>
	<div class="block clearfix">
		<div class='col-xs-12 col-sm-12'>2.code</div>
		<div class='col-xs-12 col-sm-12'>
			<textarea class='text' rows="2" id="set-pay-code">code</textarea>
		</div>
	</div>
	<div class="block clearfix">
		<div class='col-xs-12 col-sm-12'>3.mode</div>
		<div class='col-xs-12 col-sm-12'>
			<textarea class='text' rows="2" id="set-pay-mode">mode</textarea>
		</div>
	</div>
	<button class='col-xs-12 col-sm-12 btn-info btn' id='set-pay-btn'>确认</button>
</div>

<div class='container'>
	<h2 style='padding:0 15px;'>关闭京东支付</h2>
	<button class='col-xs-12 col-sm-12 btn-info btn' id='set-pay-close-btn' style="margin-bottom:50px;">确认关闭京东支付</button>
</div>
<div class="container">
	<h2 style='padding:0 15px;'>选择或者拍摄一张图片</h2>
	<button class="col-xs-12 col-sm-12 btn-info btn" id="select-image" style="margin-bottom:50px;">选择或者拍摄一张图片</button>
	<div id="image-holder" style="width:100%";>
	</div>
</div>

<div class="container">
	<h2 style='padding:0 15px;'>自定义跳转协议</h2>
	<a href="http://commonst.360buyimg.com/app.test/testURL.html">跳转已有协议页面</a>
	<div class='conatinerwrapper'>
		<div class="form-group clearfix">
			<input type="text" class="col-sm-3 col-xs-3 control-label" id="param-name-des" value='des' disabled>
			<div class="col-sm-9 col-xs-9">
				<input type="text" class="form-control" id="des" placeholder="请输入des">
			</div>
		</div>
		<div class="form-group clearfix">
			<input type="text" class="col-sm-3 col-xs-3 control-label" id="param-name" value='param1'>
			<div class="col-sm-9 col-xs-9">
				<input type="text" class="form-control" id="param" placeholder="请输入param1">
			</div>
		</div>
	</div>
	<div class='btn-wrapper btn btn-default col-sm-12 col-xs-12' id='add-param-btn'>添加param</div>
	<div class='btn-wrapper btn btn-info col-sm-12 col-xs-12' id='centerjump-btn' style='margin-top:10px;'>确认跳转</div>
</div>

<div class="container">
	<h2 style='padding:0 15px;'>关闭直播小窗</h2>
	<button class='col-xs-12 col-sm-12 btn-info btn' id='close-video-btn' style="margin-bottom:50px;">确认关闭直播小窗</button>
</div>

<div class="container">
	<h2 style='padding:0 15px;'>webview首屏加载状态协议</h2>
	<button class='col-xs-12 col-sm-12 btn-info btn' id='close-firstStatus-btn' style="margin-bottom:50px;">首屏加载状态</button>
</div>
<div class="container">
	<button class='col-xs-12 col-sm-12 btn-info btn' id='check-status-btn' style="margin-bottom:50px;">查看环境</button>
</div>


<script type="text/javascript" src="//cdn.bootcss.com/zepto/1.2.0/zepto.js"></script>
<script type="text/javascript" src="//wechatfe.github.io/vconsole/lib/vconsole.min.js?v=2.5.0"></script>
<script type="text/javascript" src="/node_modules/@jmfe/jm-common/bundle/jm-common.js"></script>
<script type="text/javascript" src="/bundle/jm-webview.js"></script>
<script type="text/javascript">
	//ios关闭xview
	$('#ios-close-btn1').on('click', function () {
		window.location.href = 'openapp.jdmobile://communication?params={' + '"action":"sh_xview_close"' + '}';
	});

	$('#ios-close-btn2').on('click', function () {
		jm.webview.XViewClose();
	});

	//定制Xview默认关闭按钮
	var closePositionX = '';
	var closePositionY = '';
	var closeIcon = document.querySelector('#closeIcon').value;
	var centerBtn = document.querySelector('#center-close-btn');
	centerBtn.addEventListener('click', function () {
		closePositionX = Number(document.querySelector('#closePositionX').value);
		closePositionY = Number(document.querySelector('#closePositionY').value);
		jm.webview.XViewConfigCloseButton(closePositionX, closePositionY, closeIcon)
	});

	//H5图片下载及指定目录保存
	var picUrl = document.querySelector('#picUrl').value;
	var centerPicBtn = document.querySelector('#center-pic-btn');
	var picChoose = document.querySelector('#pic-choose');
	window.saveImageToPhoteAlbumCallback = function (res) {
		var res = JSON.parse(res);
		console.log(res);
		if (res.code !== '0') {
			setTimeout(function () {
				alert('下载失败');
			}, 200);
		} else {
			if (res.callBackId) {
				setTimeout(function () {
					alert(res.callBackId + '下载成功');
				}, 200);
			} else {
				setTimeout(function () {
					alert('下载成功');
				}, 200);
			}
		}
	};

	picChoose.addEventListener('click', function (e) {
		//$("#picUrl").val(e.target.src.indexOf('//') != -1 ? location.protocol+e.target.src : e.target.src);
		$("#picUrl").val(e.target.src);
		$('#callBackId').val('pic' + $(e.target).data('id'));
	});
	centerPicBtn.addEventListener('click', function () {
		if (!$("#picUrl").val()) {
			alert('还没选择图片');
			return false;
		}

		jm.webview.saveImageToPhoteAlbum($("#picUrl").val(), 'saveImageToPhoteAlbumCallback', $('#callBackId').val());
	});
</script>
<script type="text/javascript">
	(function () {
		window.cb = function (res) {
			var res = JSON.parse(res);
			if (res.authResult == '1') {
				alert('认证成功')
			} else if (res.authResult == '0') {
				alert('认证失败')
			} else {
				alert('用户取消');
			}
			console.log(res);
		}
		//微信QQ授权登录
		$('#set-login-btn').on('click', function () {
			jm.webview.bindSocialAccountWithJsonString($('#set-login-channelName').val(),'cb')
		});

		//京东支付
		$('#set-pay-btn').on('click', function () {
			var pin_param = $('#set-pay-pin').val();
			var code_param = $('#set-pay-code').val();
			var mode_param = $('#set-pay-mode').val();
			jm.webview.JDPaySdk_pay(pin_param, code_param, mode_param)
		});

		//关闭支付
		$('#set-pay-close-btn').on('click', function () {
			jm.webview.JDPaySdk_pop()
		});

		//选择或者拍摄一张图片
		$('#select-image').on('click', function() {
			jm.webview.selectImage();
		})
		//设置选择图片callback函数
		window.cameraCallBack = function(path, htmlString) {
			console.log('path', path);
			console.log('htmlString', pathhtmlString);
			var url = '//m.360buyimg.com/babel/' + path;
			var img = $('<img>', {src : url});
			img.appendTo('#image-holder');
		}
	})();
</script>
<script type="text/javascript">
	var count_num = 0;

	$('body').on('click','.btn-delete',function(e){
		$(this).parent('.add-form-group')[0].remove();
	});

	$('#add-param-btn').on('click',function(){
//			var html = `<div class="form-group clearfix add-form-group">
//					    <input type="text" class="col-sm-3 col-xs-3 control-label" id="param-name-${count_num}" value='param${count_num}'>
//					    <div class="col-sm-7 col-xs-7">
//					      <input type="text" class="form-control" id="param${count_num}" placeholder="请输入param${count_num}">
//					    </div>
//					    <div class="col-sm-2 col-xs-2 btn btn-sm btn-danger btn-delete" data-index=${count_num}>删除</div>
//					</div>
//			`;
		var html = "<div class=\"form-group clearfix add-form-group\">\n\t\t\t\t\t    <input type=\"text\" class=\"col-sm-3 col-xs-3 control-label\" id=\"param-name-" + count_num + "\" value='param" + count_num + "'>\n\t\t\t\t\t    <div class=\"col-sm-7 col-xs-7\">\n\t\t\t\t\t      <input type=\"text\" class=\"form-control\" id=\"param" + count_num + "\" placeholder=\"\u8BF7\u8F93\u5165param" + count_num + "\">\n\t\t\t\t\t    </div>\n\t\t\t\t\t    <div class=\"col-sm-2 col-xs-2 btn btn-sm btn-danger btn-delete\" data-index=" + count_num + ">\u5220\u9664</div>\n\t\t\t\t\t</div>\n\t\t\t"

		$('.conatinerwrapper').append(html);
		count_num+=1;
	});

	$('#centerjump-btn').on('click',function(){
		var group_length = $('.add-form-group').length;
		var params = {
			category:'jump',
			des:$('#des').val(),
			[$('#param-name').val()]:$('#param').val(),
		}
		var dom_arr = $('.conatinerwrapper').find('.add-form-group');
		for(var i=0; i<group_length; i++){
			params[$(dom_arr[i]).find('.control-label').val()] = $(dom_arr[i]).find('.form-control').val();
		}
		params = JSON.stringify(params)
		console.log(params);
		window.location.href = 'openApp.jdMobile://virtual?params=' + params
	})
</script>
<script type="text/javascript">
	$('#close-video-btn').on('click',function(){
		jm.webview.closeLivesWindow();
	})
</script>
<script type="text/javascript">
	$('#close-firstStatus-btn').on('click',function(){
		jm.webview.sourceIsReady();
	})
	$('#check-status-btn').on('click',function(){
		var ua = navigator.userAgent.toLowerCase(),
			uaArr = ua.split(';'),
			isWk = ua.indexOf('supportjdshwk/1') !== -1 || window._is_jdsh_wkwebview==1 ? true : false;
		if(isWk) {
			alert('wK环境');
		} else {
		  	alert('非wK环境')
		}
	})
</script>

</body>

</html>
